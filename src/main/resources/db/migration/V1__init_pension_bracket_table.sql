-- ===========================================
-- 2025年神奈川县厚生年金费等级表
-- 用于厚生年金的计算
-- ===========================================

-- 创建厚生年金费等级表
CREATE TABLE pension_bracket (
    id BIGSERIAL PRIMARY KEY,
    grade VARCHAR(20) NOT NULL UNIQUE,
    std_rem INTEGER NOT NULL,
    min_amount INTEGER NOT NULL,
    max_amount INTEGER NOT NULL,
    pension NUMERIC(10, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 添加表注释
COMMENT ON TABLE pension_bracket IS '2025年神奈川县厚生年金费等级表，用于厚生年金的计算';
COMMENT ON COLUMN pension_bracket.grade IS '等级';
COMMENT ON COLUMN pension_bracket.std_rem IS '标准报酬';
COMMENT ON COLUMN pension_bracket.min_amount IS '最小值';
COMMENT ON COLUMN pension_bracket.max_amount IS '最大值（999999999表示无上限）';
COMMENT ON COLUMN pension_bracket.pension IS '厚生年金保险费';

-- 创建索引
CREATE INDEX idx_pension_bracket_grade ON pension_bracket(grade);
CREATE INDEX idx_pension_bracket_min_max ON pension_bracket(min_amount, max_amount);

-- 插入2025年神奈川县厚生年金费等级表数据
INSERT INTO pension_bracket (grade, std_rem, min_amount, max_amount, pension) VALUES
('4(1)', 88000, 83000, 93000, 16104.00),
('5(2)', 98000, 93000, 101000, 17934.00),
('6(3)', 104000, 101000, 107000, 19032.00),
('7(4)', 110000, 107000, 114000, 20130.00),
('8(5)', 118000, 114000, 122000, 21594.00),
('9(6)', 126000, 122000, 130000, 23058.00),
('10(7)', 134000, 130000, 138000, 24522.00),
('11(8)', 142000, 138000, 146000, 25986.00),
('12(9)', 150000, 146000, 155000, 27450.00),
('13(10)', 160000, 155000, 165000, 29280.00),
('14(11)', 170000, 165000, 175000, 31110.00),
('15(12)', 180000, 175000, 185000, 32940.00),
('16(13)', 190000, 185000, 195000, 34770.00),
('17(14)', 200000, 195000, 210000, 36600.00),
('18(15)', 220000, 210000, 230000, 40260.00),
('19(16)', 240000, 230000, 250000, 43920.00),
('20(17)', 260000, 250000, 270000, 47580.00),
('21(18)', 280000, 270000, 290000, 51240.00),
('22(19)', 300000, 290000, 310000, 54900.00),
('23(20)', 320000, 310000, 330000, 58560.00),
('24(21)', 340000, 330000, 350000, 62220.00),
('25(22)', 360000, 350000, 370000, 65880.00),
('26(23)', 380000, 370000, 395000, 69540.00),
('27(24)', 410000, 395000, 425000, 75030.00),
('28(25)', 440000, 425000, 455000, 80520.00),
('29(26)', 470000, 455000, 485000, 86010.00),
('30(27)', 500000, 485000, 515000, 91500.00),
('31(28)', 530000, 515000, 545000, 96990.00),
('32(29)', 560000, 545000, 575000, 102480.00),
('33(30)', 590000, 575000, 605000, 107970.00),
('34(31)', 620000, 605000, 635000, 113460.00),
('35(32)', 650000, 635000, 665000, 118950.00),
('36', 680000, 665000, 695000, 118950.00),
('37', 710000, 695000, 730000, 118950.00),
('38', 750000, 730000, 770000, 118950.00),
('39', 790000, 770000, 810000, 118950.00),
('40', 830000, 810000, 855000, 118950.00),
('41', 880000, 855000, 905000, 118950.00),
('42', 930000, 905000, 955000, 118950.00),
('43', 980000, 955000, 1005000, 118950.00),
('44', 1030000, 1005000, 1055000, 118950.00),
('45', 1090000, 1055000, 1115000, 118950.00),
('46', 1150000, 1115000, 1175000, 118950.00),
('47', 1210000, 1175000, 1235000, 118950.00),
('48', 1270000, 1235000, 1295000, 118950.00),
('49', 1330000, 1295000, 1355000, 118950.00),
('50', 1390000, 1355000, 999999999, 118950.00);

-- 创建触发器函数，用于自动更新 updated_at 字段
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

-- 创建触发器
CREATE TRIGGER update_pension_bracket_updated_at
    BEFORE UPDATE ON pension_bracket
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();
